.PHONY: all

all: ktouch-lessons-1.xml ktouch-lessons-2.xml ktouch-lessons-3.xml
	@echo "=> Done"

.PHONY: clean
clean:
	@echo "=> Cleaning..."
	-@rm -rf ktouch-lesson-generator
	@echo "=> Done"

google-10000-english-usa-no-swears.txt:
	@echo "=> Downloading $@..."
	wget https://raw.githubusercontent.com/first20hours/google-10000-english/refs/heads/master/google-10000-english-usa-no-swears.txt
	@echo "=> Downloaded $@"

ktouch-lessons-1.xml: engrammer.ktgen google-10000-english-usa-no-swears.txt
	@echo "=> Generating $@..."
	@rm -f ktouch-lessons-1.xml
	@docker run --rm -v $(PWD)/:/files barbiecue/ktgen:latest /files/engrammer.ktgen -web https://raw.githubusercontent.com/first20hours/google-10000-english/refs/heads/master/google-10000-english-usa-no-swears.txt -o | sed -E -e 's/>Generated by ktgen</>Engrammer (US) Lessons - 1</g' -e 's|<keyboardLayout/>|<keyboardLayout>us(engrammer)</keyboardLayout>|g' > ktouch-lessons-1.xml
	@echo "=> Generated $@"

ktouch-lessons-2.xml: google-10000-english-usa-no-swears.txt Engrammer-US-keyboard-layout.xml
	@echo "=> Generating $@..."
	@docker run --rm -v $(PWD)/:/files barbiecue/ktgen:latest /files/Engrammer-US-keyboard-layout.xml -web https://raw.githubusercontent.com/first20hours/google-10000-english/refs/heads/master/google-10000-english-usa-no-swears.txt -o | sed -E -e 's/>Generated by ktgen</>Engrammer (US) Lessons - 2</g' -e 's|<keyboardLayout/>|<keyboardLayout>us(engrammer)</keyboardLayout>|g' > ktouch-lessons-2.xml
	@echo "=> Generated $@"

ktouch-lessons-3.xml: google-10000-english-usa-no-swears.txt engrammer-ktouch-lesson-generator.txt ktouch-lesson-generator
	@echo "=> Generating $@..."
	@cd ktouch-lesson-generator && pip3 install --user -r requirements.txt
	@cd ktouch-lesson-generator && python3 ktouch-lesson-generator.py --characters-per-lesson=1000 ../engrammer-ktouch-lesson-generator.txt ../google-10000-english-usa-no-swears.txt
	@cd ktouch-lesson-generator && sed -E -e 's|<title>KTouch-Generator-[a-f0-9]*</title>|<title>Engrammer (US) Lessons - 3</title>|' -e 's|<title>Lezione |<title>Lesson |' -e 's|<keyboardLayout></keyboardLayout>|<keyboardLayout>us(engrammer)</keyboardLayout>|g' < ktouch-lessons.xml > ../ktouch-lessons-3.xml
	@echo "=> Generated $@"
	@$(MAKE) clean

ktouch-lesson-generator:
	@echo "Cloning $@..."
	@git clone https://github.com/simgunz/ktouch-lesson-generator
	@echo "Cloned $@"
